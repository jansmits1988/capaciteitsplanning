SELECT zorglevering.DIM_PATIENT,
  zorglevering.DIM_ZORGLEVERING,
  zorglevering.pat_referentie,
  zorglevering.pat_id,
  zorglevering.NM_SAMENGESTELD,
  zorglevering.mod_referentie,
  zorglevering.ISO_OP_WACHTLIJST,
  zorglevering.ISO_VAN_WACHTLIJST,
  zorglevering.ISO_BEGIN_ZORGL,
  zorglevering.ISO_EINDE_ZORGL,
  zorglevering.ISO_GEPLAND_BEGIN,
  zorglevering.ISO_VERMOEDELIJK_EINDE,
  zorglevering.IND_ZORGTOEWIJZING,
  zorglevering.AANT_D_OP_WACHTL,
  zorglevering.AANT_D_VAN_WACHTL,
  zorglevering.AANT_D_GESTART,
  zorglevering.AANT_D_TOT_VERM_BEGIN,
  zorglevering.AANT_D_TOT_VERM_EINDE,
  zorglevering.D_START_ZORGCASUS,
  zorglevering.D_EINDE_ZORGCASUS,
  zorglevering.D_OP_WACHTLIJST_ZORGPROG,
  zorglevering.D_VAN_WACHTLIJST_ZORGPROG,
  zorglevering.D_BEGIN_ZORGPROGRAMMA,
  zorglevering.D_EINDE_ZORGPROGRAMMA,
  zorglevering.D_VERMOEDELIJK_EINDE,
  zorglevering.D_GEPLAND_BEGIN,
  zorglevering.D_OP_WACHTLIJST,
  zorglevering.D_VAN_WACHTLIJST,
  zorglevering.D_BEGIN_ZORGL,
  zorglevering.D_EINDE_ZORGL,
  zorg_prod.Sum_IND_GEFIATTEERD,
  zorg_prod.Sum_IND_GEANNULEERD,
  zorg_prod.Sum_IND_PAT_AANWEZIG,
  zorg_prod.Sum_AANT_MIN_AFSPRAAK,
  zorg_prod.Sum_AANT_MIN_AFSPRAAK_REAL,
  zorg_prod.Sum_AANT_UUR_AFSPRAAK,
  zorg_prod.Sum_AANT_UUR_AFSPRAAK_REAL,
  zorg_prod.Sum_AANT_MIN_DIRECT,
  zorg_prod.Sum_AANT_MIN_INDIRECT,
  zorg_prod.Sum_AANT_MIN_DIRECT_DBC,
  zorg_prod.Sum_AANT_MIN_INDIRECT_DBC,
  zorg_plan.PLAN_Sum_IND,
  zorg_plan.PLAN_Sum_AANT_MIN_AFSPRAAK,
  zorg_plan.PLAN_Sum_AANT_UUR_AFSPRAAK,
  zorglevering.mod_id,
  wldetail.HCDEFINITIEF_IDT,
  wldetail.ACTIVITEIT_REF,
  wldetail.OPMERKING,
  wldetail.MODULE,
  wldetail.STATUS_REF,
  wldetail.INTERVAL_ACT_REF,
  wldetail.FREQUENTIE_ACT_REF,
  wldetail.ACTIVITEIT_IDT,
  wldetail.CONTACT,
  wldetail.ID,
  wlevaluatie.ID AS ID1,
  wlevaluatie.ALGEMEEN_MODEL_DATA_DETAILS,
  wlevaluatie.EVALUATIE,
  wlevaluatie.HULPVELDEN_ZORGLEVERING,
  wlevaluatie.EVALUATIE_EVALUATIE_DATUM_D,
  wldetail.STATUS_IDT
FROM
  (SELECT aanm.DIM_PATIENT,
    zlv.DIM_ZORGLEVERING,
    zlv.DIM_DAG,
    to_date(zlv.DIM_DAG, 'yyyymmdd') AS DATUM,
    dim_pat.REFERENTIE               AS pat_referentie,
    dim_pat.ID                       AS pat_id,
    dim_pat.NM_SAMENGESTELD,
    dim_mod.REFERENTIE AS mod_referentie,
    zlv.ISO_OP_WACHTLIJST,
    zlv.ISO_VAN_WACHTLIJST,
    zlv.ISO_BEGIN_ZORGL,
    zlv.ISO_EINDE_ZORGL,
    zlv.ISO_GEPLAND_BEGIN,
    zlv.ISO_VERMOEDELIJK_EINDE,
    zlv.IND_ZORGTOEWIJZING,
    zlv.AANT_D_OP_WACHTL,
    zlv.AANT_D_VAN_WACHTL,
    ROUND(zlv.AANT_D_GESTART, 0) AS AANT_D_GESTART,
    zlv.AANT_D_TOT_VERM_BEGIN,
    zlv.AANT_D_TOT_VERM_EINDE,
    zlv.D_START_ZORGCASUS,
    zlv.D_EINDE_ZORGCASUS,
    zlv.D_OP_WACHTLIJST_ZORGPROG,
    zlv.D_VAN_WACHTLIJST_ZORGPROG,
    zlv.D_BEGIN_ZORGPROGRAMMA,
    zlv.D_EINDE_ZORGPROGRAMMA,
    zlv.D_VERMOEDELIJK_EINDE,
    zlv.D_GEPLAND_BEGIN,
    zlv.D_OP_WACHTLIJST,
    zlv.D_VAN_WACHTLIJST,
    zlv.D_BEGIN_ZORGL,
    zlv.D_EINDE_ZORGL,
    dim_mod.ID AS mod_id
  FROM VW_FCT_ZORGLEVERING zlv
  INNER JOIN vw_Dim_Aanmelding aanm
  ON zlv.DIM_AANMELDING = aanm.ID
  INNER JOIN vw_DIM_MODULE dim_mod
  ON zlv.DIM_MODULE = dim_mod.ID
  INNER JOIN vw_DIM_PATIENT dim_pat
  ON aanm.DIM_PATIENT                  = dim_pat.ID
  WHERE aanm.DIM_PATIENT              IN (:patient_id)
  AND to_date(zlv.DIM_DAG, 'yyyymmdd') = :peildatum
  ) zorglevering
LEFT JOIN
  (SELECT DMT_FCT_AGENDA_PROD_PAT.DIM_PATIENT,
    DMT_FCT_AGENDA_PROD_PAT.DIM_ZORGLEVERING,
    SUM(DMT_FCT_AGENDA_PROD_PAT.IND_GEFIATTEERD)        AS Sum_IND_GEFIATTEERD,
    SUM(DMT_FCT_AGENDA_PROD_PAT.IND_AFGEHANDELD)        AS Sum_IND_AFGEHANDELD,
    SUM(DMT_FCT_AGENDA_PROD_PAT.IND_GEANNULEERD)        AS Sum_IND_GEANNULEERD,
    SUM(DMT_FCT_AGENDA_PROD_PAT.IND_PAT_AANWEZIG)       AS Sum_IND_PAT_AANWEZIG,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_AFSPRAAK)      AS Sum_AANT_MIN_AFSPRAAK,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_AFSPRAAK_REAL) AS Sum_AANT_MIN_AFSPRAAK_REAL,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_UUR_AFSPRAAK)      AS Sum_AANT_UUR_AFSPRAAK,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_UUR_AFSPRAAK_REAL) AS Sum_AANT_UUR_AFSPRAAK_REAL,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_DIRECT)        AS Sum_AANT_MIN_DIRECT,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_INDIRECT)      AS Sum_AANT_MIN_INDIRECT,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_REISTIJD)      AS Sum_AANT_MIN_REISTIJD,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_DIRECT_DBC)    AS Sum_AANT_MIN_DIRECT_DBC,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_INDIRECT_DBC)  AS Sum_AANT_MIN_INDIRECT_DBC,
    SUM(DMT_FCT_AGENDA_PROD_PAT.AANT_MIN_REISTIJD_DBC)  AS Sum_AANT_MIN_REISTIJD_DBC
  FROM DMT_FCT_AGENDA_PROD_PAT
  WHERE to_date(DMT_FCT_AGENDA_PROD_PAT.DIM_DAG, 'yyyymmdd') <= :peildatum
  AND DMT_FCT_AGENDA_PROD_PAT.DIM_PATIENT                    IN (:patient_id)
  GROUP BY DMT_FCT_AGENDA_PROD_PAT.DIM_PATIENT,
    DMT_FCT_AGENDA_PROD_PAT.DIM_ZORGLEVERING
  ) zorg_prod
ON zorglevering.DIM_PATIENT       = zorg_prod.DIM_PATIENT
AND zorglevering.DIM_ZORGLEVERING = zorg_prod.DIM_ZORGLEVERING
LEFT JOIN
  (SELECT VW_FCT_AGENDA_PROD_PAT.DIM_PATIENT,
    VW_FCT_AGENDA_PROD_PAT.DIM_ZORGLEVERING,
    SUM(1)                                        AS PLAN_Sum_IND,
    SUM(VW_FCT_AGENDA_PROD_PAT.AANT_MIN_AFSPRAAK) AS PLAN_Sum_AANT_MIN_AFSPRAAK,
    SUM(VW_FCT_AGENDA_PROD_PAT.AANT_UUR_AFSPRAAK) AS PLAN_Sum_AANT_UUR_AFSPRAAK
  FROM VW_FCT_AGENDA_PROD_PAT
  WHERE to_date(VW_FCT_AGENDA_PROD_PAT.DIM_DAG, 'yyyymmdd') > :peildatum
  GROUP BY VW_FCT_AGENDA_PROD_PAT.DIM_PATIENT,
    VW_FCT_AGENDA_PROD_PAT.DIM_ZORGLEVERING
  ) zorg_plan
ON zorglevering.DIM_PATIENT       = zorg_plan.DIM_PATIENT
AND zorglevering.DIM_ZORGLEVERING = zorg_plan.DIM_ZORGLEVERING
LEFT JOIN
  (SELECT NULL                                       AS HCDEFINITIEF_IDT,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_ACTIVITEIT_REF     AS ACTIVITEIT_REF,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_OPMERKING          AS OPMERKING,
    mtb.DRW_WL_DETAILS.OPT_HULPVELDEN_SEQ_MODULE     AS MODULE,
    mtb.DRW_WL_DETAILS.C2_ALGEMEEN_STATUS_REF        AS STATUS_REF,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_INTERVAL_ACT_REF   AS INTERVAL_ACT_REF,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_FREQUENTIE_ACT_REF AS FREQUENTIE_ACT_REF,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_ACTIVITEIT_IDT     AS ACTIVITEIT_IDT,
    mtb.DRW_WL_DETAILS.ACTIVITEIT_AANTAL_CONTACT     AS CONTACT,
    mtb.DRW_WL_DETAILS.ID                            AS ID,
    mtb.DRW_WL_DETAILS.OPT_HULPVELDEN_ZORGLEVERING   AS zorglevering,
    mtb.DRW_WL_DETAILS.C2_ALGEMEEN_STATUS_IDT        AS STATUS_IDT
  FROM mtb.DRW_WL_DETAILS
  ) wldetail
ON wldetail.zorglevering = zorglevering.DIM_ZORGLEVERING
LEFT JOIN
  (SELECT MTB.DRW_WL_EVALUATIE.ID,
    MTB.DRW_WL_EVALUATIE.OPT_HULPVELDEN_DATA_DETAILS                                   AS ALGEMEEN_MODEL_DATA_DETAILS,
    MTB.DRW_WL_EVALUATIE.EVALUATIE_EVALUATIE                                                       AS EVALUATIE,
    MTB.DRW_WL_EVALUATIE.EVALUATIE_EVALUATIE_DATUM_ISO                                             AS iso_EVALUATIE_01_EVALUATIE,
    TO_CHAR(TO_DATE(MTB.DRW_WL_EVALUATIE.EVALUATIE_EVALUATIE_DATUM_ISO, 'yyyymmdd'), 'DD-MM-YYYY') AS EVALUATIE_EVALUATIE_DATUM_D,
    MTB.DRW_WL_EVALUATIE.OPT_HULPVELDEN_SEQ_ZORGLEVERING                                           AS HULPVELDEN_ZORGLEVERING,
    MTB.DRW_WL_EVALUATIE.OPT_HULPVELDEN_DATA_DETAILS
  FROM MTB.DRW_WL_EVALUATIE
  ) wlevaluatie
ON wlevaluatie.HULPVELDEN_ZORGLEVERING        = zorglevering.DIM_ZORGLEVERING
AND wlevaluatie.OPT_HULPVELDEN_DATA_DETAILS = wldetail.ID
WHERE zorglevering.DIM_PATIENT               IN (:patient_id)
AND zorglevering.mod_id                      IN (:module)
AND (wldetail.STATUS_IDT                     IN (:status)
OR wldetail.STATUS_IDT                       IS NULL)